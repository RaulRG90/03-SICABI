var componentes=base_url+"assets/js/editorial/registro_titulos/componentes.min.js",api_leer_datos_activacion=base_url+"editorial/registro_titulos/datos_activacion_editorial",api_activar_editorial=base_url+"editorial/registro_titulos/activar_editorial",api_leer_datos_registro_titulo=base_url+"editorial/registro_titulos/datos_registro/",api_leer_titulos_registrados=base_url+"editorial/registro_titulos/titulos_registrados/",api_crear_autor=base_url+"editorial/registro_titulos/crear_autor",api_eliminar_autor=
base_url+"editorial/registro_titulos/eliminar_autor",api_registrar_titulo=base_url+"editorial/registro_titulos/registrar_titulo",componente_cabecera,componente_btn_registrar_titulo,componente_tabla_titulos_registrados,componente_form_registro_titulos,componente_form_autor,componente_form_activacion_editorial,datos={};
$(document).ready(function(){function e(b,a,c="",d="GET"){$.ajax({url:b,type:d,dataType:"JSON",async:!1,data:c,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(b){datos[a]=b}})}function g(b){$("#section_titulos_registrados").append(componente_tabla_titulos_registrados.render());let a=$("#tbl_titulos_registrados");componente_tabla_titulos_registrados.habilitar_datatable(a,api_leer_titulos_registrados,b)}function h(){let b={},a=$("#form_activacion_editorial_rfc").val(),
c=$("#form_activacion_editorial_grupo_editorial").val(),d=$("#form_activacion_editorial_colonia").val(),f=$("#form_activacion_editorial_calle").val(),k=$("#form_activacion_editorial_numero_exterior").val(),e=$("#form_activacion_editorial_cp").val(),g=$("#form_activacion_editorial_ciudad").val(),h=$("#form_activacion_editorial_pais").val(),l=$("#form_activacion_editorial_entidad_federativa").val(),m=$("#form_activacion_editorial_del_mun").val(),n=$("#form_activacion_editorial_telefono").val(),p=$("#form_activacion_editorial_email").val();
b.folio=datos.editorial_folio;b.edi_rfc=a;b.edi_grupoedit=c;b.edi_colonia=d;b.edi_calle=f;b.edi_numero=k;b.edi_cp=e;b.edi_ciudad=g;b.edi_pais=h;b.edi_entidad_federativa=l;b.edi_delegacion=m;b.edi_telefonos=n;b.edi_email=p;return b}sessionStorage.clear();datos.editorial_estatus=$("#editorial_estatus").val();datos.editorial_folio=$("#editorial_folio").val();e(api_leer_datos_registro_titulo,"registro",`folio=${datos.editorial_folio}`,"POST");e(api_leer_datos_activacion,"activacion",`folio=${datos.editorial_folio}`,
"POST");$("#cabecera_principal").children().remove();$("#btn_registrar_titulo").children().remove();$("#seccion_frm_registro").children().remove();(function(){$.ajax({async:!1,url:componentes,dataType:"SCRIPT",success:function(){componente_cabecera=cabecera;componente_btn_registrar_titulo=btn_registrar_titulo;componente_tabla_titulos_registrados=tabla_titulos_registrados;componente_form_registro_titulos=form_registro_titulos;componente_form_autor=form_autor;componente_form_activacion_editorial=form_activacion_editorial}})})();
"1"===datos.editorial_estatus?($("#cabecera_principal").append(componente_cabecera.render(base_url,datos.editorial_folio)),$("#btn_registrar_titulo").append(componente_btn_registrar_titulo.render()),g(datos.editorial_folio)):(componente_form_activacion_editorial.data=datos.activacion,componente_form_activacion_editorial.alertar("Antes de iniciar con el registro de titulos debe validar los siguientes datos"),componente_form_activacion_editorial.render());$("#btn_registrar_titulo").on("click",b=>{0===
$("#seccion_frm_registro").children().length&&($("#section_titulos_registrados").children().hide(),componente_form_registro_titulos.data=datos.registro,$("#seccion_frm_registro").append(componente_form_registro_titulos.render()),componente_form_autor.data=datos.registro,$("#modales").append(componente_form_autor.render()),$("#eliminar_autor").on("click",a=>{let b=$(a.target).attr("autor");a={aut_nombre:b};"false"!=b?$.ajax({async:!0,type:"POST",dataType:"JSON",contentType:"application/x-www-form-urlencoded; charset=UTF-8",
url:api_eliminar_autor,data:a,success:function(a){a.error?swal("Error!",a.error.message,"error"):(swal("Correcto!",a.message,"success"),$("#form_registro_autor").children(`option[value='${b}']`).remove(),console.log($("#form_registro_autor").children(`option[value='${b}']`)))},error:function(a){swal("Error!","Error desconocido, comuniquese con el administrador","error")}}):swal("Error!","El campo nombre del autor es obligatorio","error")}),$("#form_autores").on("submit",a=>{a.preventDefault();a.stopPropagation();
!1===a.target.checkValidity()?this.classList.add("was-validated"):(a={aut_tipo:$("#form_autores_tipo_autor").val(),aut_nombre:$("#form_autores_nombre").val(),aut_pais:$("#form_autores_pais_origen").val()},$.ajax({async:!0,type:"POST",dataType:"JSON",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:api_crear_autor,data:a,success:function(a){let b=$("#form_autores_tipo_autor").val(),c=$("#form_autores_nombre").val();a.error?swal("Error!",a.error.message,"error"):(swal("Correcto!",
a.message,"success"),$("#form_registro_autor").append($("<option>",{value:c}).text(`${b} | ${c}`)))},error:function(a){swal("Error!","Error desconocido, comuniquese con el administrador","error")}}))}),$("#form_registro_autor").on("change",a=>{$("#eliminar_autor").attr("autor",$(a.target).val())}),$("#form_registro").on("submit",a=>{a.preventDefault();a.stopPropagation();!1===a.target.checkValidity()?$(a.target).addClass("was-validated"):(a={edi_id:datos.editorial_folio,titulo:$("#form_registro_titulo").val(),
titulo_original:$("#form_registro_titulo_original").val(),autor:$("#form_registro_autor").val(),indice_titulo:$("#form_registro_indice_titulo").val(),material_lengua_indigena:$("#form_registro_material_lengua_indigena").val(),sello_id:$("#form_registro_sello").val(),edicion:$("#form_registro_edicion").val(),anio:$("#form_registro_anio").val(),tiraje:$("#form_registro_tiraje").val(),resenia:$("#form_registro_resenia").val(),isbn:$("#form_registro_isbn").val(),paginas_con_folio:$("#form_registro_paginas_con_folio").val(),
pais:$("#form_registro_pais").val(),ciudad:$("#form_registro_ciudad").val(),reconocimiento_libro:$("#form_registro_reconocimiento_libro").val(),reconocimiento_autor:$("#form_registro_reconocimiento_autor").val(),reconocimiento_ilustrador:$("#form_registro_reconocimiento_ilustrador").val(),nivel:$("#form_registro_nivel").val(),genero:$("#form_registro_genero").val(),categoria:$("#form_registro_categoria").val(),precio_publico:$("#form_registro_precio_publico").val(),disponibilidad:$("#form_registro_disponibilidad").val(),
numero_tipo_papel:$("#form_registro_tipo_papel").val(),formato:$("#form_registro_formato").val(),ancho:$("#form_registro_ancho").val(),alto:$("#form_registro_alto").val(),paginas_totales:$("#form_registro_paginas_totales").val(),paginas_preliminares:$("#form_registro_paginas_preliminares").val(),paginas_finales:$("#form_registro_paginas_finales").val(),lomo:$("#form_registro_lomo").val()},$("#form_registro_check_antologia").prop("checked")&&(a.antologia=1),$("#form_registro_check_ilustrado").prop("checked")&&
(a.ilustrado=1),$.ajax({async:!0,type:"POST",dataType:"JSON",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:api_registrar_titulo,data:a,success:function(a){a.error?swal("Error!",a.error.message,"error"):(swal("Correcto!",a.message,"success"),$("#section_titulos_registrados").children().show(),$("#seccion_frm_registro").children().remove(),a=$("#tbl_titulos_registrados").DataTable(),console.log(a),a.ajax.reload(null,!1))},error:function(a){swal("Error!","Error desconocido, comuniquese con el administrador",
"error")}}))}),$("#btn_cancelar_registro").on("click",a=>{a.preventDefault();$("#section_titulos_registrados").children().show();$("#seccion_frm_registro").children().remove()}),$("button.collapsed").off("click"),$("button.collapsed").on("click",a=>{a.preventDefault();a.stopPropagation();a=$(a.target).attr("aria-controls");let b=$(`#${a}`).attr("class");$("div.collapse").removeClass("show");"collapse"==b&&($(`div#${a}`).addClass("show"),console.log(b),console.log($(`div#${a}`)))}))});$(document).off("submit",
"#form_activacion_editorial");$(document).on("submit","#form_activacion_editorial",function(b){b.preventDefault();b.stopPropagation();b=h();$.ajax({url:api_activar_editorial,type:"POST",dataType:"JSON",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:b,success:function(a){"Editorial Activada"===a.message?(swal("Exito!",a.message,"success"),location.reload()):swal("Error!",a.error.message,"error")},error:function(a){console.log(a)}})});$(document).on("focusout","#form_activacion_editorial_pais",
b=>{b=JSON.parse(sessionStorage.getItem("mostrar_entidades"));if("M\u00e9xico"===$("#form_activacion_editorial_pais").val()){if(null===b||!1===b){b=$("#form_activacion_editorial_entidad_federativa");var a=$(b).parent();let c=$("<select>",{"class":"custom-select",id:"form_activacion_editorial_entidad_federativa"});JSON.parse(sessionStorage.getItem("datos_activacion"));console.log(datos);datos.activacion.estados.data.forEach(a=>{let b=$("<option>",{value:a.est_estado});$(b).text(a.est_estado);$(c).append(b)});
$(a).append($(c));$(b).remove();sessionStorage.setItem("mostrar_entidades","true")}}else if(null!==b||!0===b){b=$("#form_activacion_editorial_entidad_federativa");a=$("#form_activacion_editorial_del_mun");let c=$(b).parent(),d=$(a).parent(),f=$("<input>",{type:"text","class":"form-control",id:"form_activacion_editorial_entidad_federativa"}),k=$("<input>",{type:"text","class":"form-control",id:"form_activacion_editorial_del_mun"});$(c).append($(f));$(d).append($(k));$(b).remove();$(a).remove();sessionStorage.setItem("mostrar_entidades",
"false")}});$(document).on("focusout","#form_activacion_editorial_entidad_federativa",b=>{b=$("#form_activacion_editorial_del_mun");let a=$(b).parent(),c=$("<select>",{"class":"custom-select",id:"form_activacion_editorial_del_mun"});JSON.parse(sessionStorage.getItem("datos_activacion"));let d=datos.activacion.estados.data.filter(a=>a.est_estado===$("#form_activacion_editorial_entidad_federativa").val());$(c).children().remove();datos.activacion.municipios.data.forEach(a=>{if(d[0].est_id===a.est_id){let b=
$("<option>",{value:a.mun_municipio});$(b).text(a.mun_municipio);$(c).append(b)}});$(a).append($(c));$(b).remove()})});