var numSellos=1;$("#btnCancelar").on("click",function(){$("#frmAcreditarEditorial").trigger("reset");limpiarSellos()});$(document).off("click","#btn_accion");$(document).on("click","#btn_accion",function(){$("#tabla_editoriales").css("display","none");$("#frm_editar_editorial").trigger("reset");$("#frmAcreditarEditorial").trigger("reset");limpiarSellos();$("#mdlAcreditarEditorial").css("display","block")});$(document).off("click","#btnCancelar");
$(document).on("click","#btnCancelar",function(){$("#mdlAcreditarEditorial").css("display","none");$("#mdl_editar_editorial").css("display","none");$("#tabla_editoriales").css("display","block")});$(document).off("click",".btn_edit");
$(document).on("click",".btn_edit",function(){let a=$(this).attr("id_editorial");datosJSON={id:a};$.ajax({async:!1,type:"POST",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:api_buscar_editorial,data:datosJSON,success:function(a){sessionStorage.clear();a.forEach(function(a){sessionStorage.setItem(JSON.stringify(a.id),JSON.stringify(a))})},error:function(a){swal("Ateci\u00f3n!","No se encontraron coincidencias","warning")}});let b=JSON.parse(sessionStorage.getItem('"'+
a+'"'));console.log(b);$("#mdl_editar_editorial").modal("show");$("#mdl_editar_editorial #edit_txt_razon_social").focus();$("#mdl_editar_editorial #edit_txt_razon_social").attr("id_editorial",b.id);$("#mdl_editar_editorial #edit_txt_razon_social").val(b.edi_razonsocial);$("#mdl_editar_editorial #edit_txt_grupo_editorial").val(b.edi_grupoedit);$("#mdl_editar_editorial #edit_txt_nombre_director_general").val(b.edi_dirgeneral);$("#mdl_editar_editorial #edit_txt_email_director_general").val(b.edi_dirmail);
$("#mdl_editar_editorial #edit_txt_celular_director_general").val(b.edi_dircel);$("#mdl_editar_editorial #edit_txt_nombre_representante_editorial").val(b.edi_repnombre);$("#mdl_editar_editorial #edit_txt_cargo_representante_editorial").val(b.edi_repcargo);$("#mdl_editar_editorial #edit_txt_email_representante_editorial").val(b.edi_repemail);$("#mdl_editar_editorial #edit_txt_observaciones").val(b.edi_observaciones);$("#frmAcreditarEditorial").trigger("reset");limpiarSellos();let c=0;b.sellos.forEach(function(a){c++;
$("#mdl_editar_editorial #edit_txt_sello_editorial_"+numSellos).val(a.sel_sello);c<b.sellos.length&&$("#edit_sello_editorial_"+numSellos+" button.btn_agregar_sello_editar").trigger("click")})});$(document).off("submit","#frm_editar_editorial");
$(document).on("submit","#frm_editar_editorial",function(a){a.preventDefault();a=extraerEditarDatos();console.log(a);$.ajax({url:api_actualizar_editorial,async:!0,type:"POST",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:a,success:function(a){$("#mdl_editar_editorial").modal("hide");swal("Actualizaci\u00f3n Exitosa!","La editorial se actualiz\u00f3 con exito","success");$("#tbl_editoriales").DataTable().ajax.reload(null,!1)},error:function(a){swal("Error en la actualizaci\u00f3n!",
"La editorial no se pudo actualizar con exito","error");document.write(a.responseText)}})});$(document).off("click",".btn_eliminar_editorial");
$(document).on("click",".btn_eliminar_editorial",function(){let a=$(this).attr("id_editorial");swal({title:"\u00bfEstas seguro?",text:"\u00a1No podras deshacer esto!",type:"warning",showCancelButton:!0,confirmButtonClass:"btn-danger",confirmButtonText:"\u00a1Si, Hazlo!",closeOnConfirm:!1},function(){$.ajax({url:api_eliminar_editorial,type:"POST",data:{usu_id:a},dataType:"json",success:function(){swal("Editorial Eliminada!","La editorial se elimin\u00f3 con exito!","success");$("#tbl_editoriales").DataTable().ajax.reload(null,
!1)},error:function(a){swal("Error!","La editorial no se pudo eliminar con exito!","error");console.log(a)}})})});function habilitarAgregarSello(){$(".btn_agregar_sello").off("click");$(".btn_agregar_sello").click(function(){let a=$(this).parent().parent();quitarBtnAgregarSello(this);crearInputGroup(a);$(this).remove();habilitarAgregarSello();habilitarEliminarSello()})}
function quitarBtnAgregarSello(a){$("#"+$(a).parent().parent().attr("id")+" div.input-group-append button.btnEliminarSello").attr("btnagregarsello")&&$("#"+$(a).parent().parent().attr("id")+" div.input-group-append button.btnEliminarSello").attr("btnagregarsello","false")}
function crearInputGroup(a){numSellos++;$(a).after($("<div>",{id:"sello_editorial_"+numSellos,"class":"input-group mb-3 sello_editorial"}).append($("<div>",{"class":"input-group-prepend"}).append($("<span>",{"class":"input-group-text"}).text("Sello Editorial:"))).append($("<input>",{id:"txt_sello_editorial_"+numSellos,type:"text","class":"form-control sello_editorial",placeholder:"Nuevo sello editorial",required:"required"})).append($("<div>",{"class":"input-group-append"}).append($("<button>",{type:"button",
"class":"btn btn-danger btnEliminarSello",btnAgregarSello:"true"}).append($("<i>",{"class":"far fa-minus-square"}))).append($("<button>",{type:"button","class":"btn btn-primary btn_agregar_sello"}).append($("<i>",{"class":"far fa-plus-square"})))))}
function habilitarEliminarSello(){$(".btnEliminarSello").off("click");$(".btnEliminarSello").click(function(){"true"===$(this).attr("btnagregarsello")&&soltarBtnAgregarSello($(this).parent().parent().attr("id"));$("#"+$(this).parent().parent().attr("id")).remove()})}
function soltarBtnAgregarSello(a){$("#"+$("#"+a).prev().attr("id")+" div.input-group-append").append($(".btn_agregar_sello"));$("#"+$("#"+a).prev().attr("id")+" div.input-group-append button.btnEliminarSello").attr("btnagregarsello","true");habilitarAgregarSello()}
$("#frmAcreditarEditorial").on("submit",function(a){a.preventDefault();a.stopPropagation();if(!1===this.checkValidity())this.classList.add("was-validated");else{let a=extraerDatos();$.ajax({async:!0,type:"POST",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:api_acreditar_editorial,data:a,success:function(b){b.error?swal("Error!",b.error.message,"error"):(swal({title:"\u00a1Exito!",text:"Editorial Acreditada",type:"success",showCancelButton:!0,cancelButtonText:"Cerrar",
cancelButtonClass:"btn-danger",confirmButtonClass:"btn-info",confirmButtonText:"Descargar",closeOnConfirm:!1},function(){window.open(api_crear_acuse+a.edi_razonsocial)}),$("#frmAcreditarEditorial").trigger("reset"),limpiarSellos(),$("#tbl_editoriales").DataTable().ajax.reload(null,!1))},error:function(a){swal("Error!","Error desconocido, comuniquese con el administrador","error")}})}});
function extraerDatos(){return{edi_razonsocial:$("#txt_razon_social").val(),edi_grupoedit:$("#txt_grupo_editorial").val(),sellos:extraerSellos(),edi_dirgeneral:$("#txt_nombre_director_general").val(),edi_dirmail:$("#txt_email_director_general").val(),edi_dircel:$("#txt_celular_director_general").val(),edi_repnombre:$("#txt_nombre_representante_editorial").val(),edi_repcargo:$("#txt_cargo_representante_editorial").val(),edi_repemail:$("#txt_email_representante_editorial").val(),edi_observaciones:$("#txt_observaciones").val()}}
function extraerSellos(){let a=0,b="{";$(".sello_editorial").each(function(){""!=$(this).val()&&(b+='"'+a+'":"'+$(this).val()+'",',a++)});b=b.slice(0,b.length-1);return b+="}"}function limpiarSellos(){$(".sello_editorial").each(function(a){a=$(this).attr("id");$("#"+a+" button.btnEliminarSello").trigger("click");numSellos=1})}
function habilitarAgregarSelloEditar(){$(".btn_agregar_sello_editar").off("click");$(".btn_agregar_sello_editar").click(function(){let a=$(this).parent().parent();quitarBtnAgregarSello(this);crearInputGroupEditar(a);$(this).remove();habilitarAgregarSelloEditar();habilitarEliminarSelloEditar()})}
function crearInputGroupEditar(a){numSellos++;$(a).after($("<div>",{id:"edit_sello_editorial_"+numSellos,"class":"input-group mb-3 sello_editorial"}).append($("<div>",{"class":"input-group-prepend"}).append($("<span>",{"class":"input-group-text"}).text("Sello Editorial:"))).append($("<input>",{id:"edit_txt_sello_editorial_"+numSellos,type:"text","class":"form-control edit_sello_editorial",placeholder:"Nuevo sello editorial",required:"required"})).append($("<div>",{"class":"input-group-append"}).append($("<button>",
{type:"button","class":"btn btn-danger btnEliminarSello",btnAgregarSello:"true"}).append($("<i>",{"class":"far fa-minus-square"}))).append($("<button>",{type:"button","class":"btn btn-primary btn_agregar_sello_editar"}).append($("<i>",{"class":"far fa-plus-square"})))))}
function habilitarEliminarSelloEditar(){$(".btnEliminarSello").off("click");$(".btnEliminarSello").click(function(){"true"===$(this).attr("btnagregarsello")&&soltarBtnAgregarSelloEditar($(this).parent().parent().attr("id"));$("#"+$(this).parent().parent().attr("id")).remove()})}
function soltarBtnAgregarSelloEditar(a){$("#"+$("#"+a).prev().attr("id")+" div.input-group-append").append($(".btn_agregar_sello_editar"));$("#"+$("#"+a).prev().attr("id")+" div.input-group-append button.btnEliminarSello").attr("btnagregarsello","true");habilitarAgregarSelloEditar()}
function extraerEditarDatos(){return{id:$("#edit_txt_razon_social").attr("id_editorial"),razonSocial:$("#edit_txt_razon_social").val(),grupoEditorial:$("#edit_txt_grupo_editorial").val(),sellos:extraerSellosEdit(),nombreDirectorGeneral:$("#edit_txt_nombre_director_general").val(),emailDirectorGeneral:$("#edit_txt_email_director_general").val(),celularDirectorGeneral:$("#edit_txt_celular_director_general").val(),nombreRepresentanteEditorial:$("#edit_txt_nombre_representante_editorial").val(),cargoRepresentanteEditorial:$("#edit_txt_cargo_representante_editorial").val(),
emailRepresentanteEditorial:$("#edit_txt_email_representante_editorial").val(),observaciones:$("#edit_txt_observaciones").val()}}function extraerSellosEdit(){let a=0,b={};$(".edit_sello_editorial").each(function(){""!=$(this).val()&&(b[a]=$(this).val(),a++)});return b}habilitarAgregarSello();habilitarAgregarSelloEditar();habilitarEliminarSello();