var numSellos=1;$("#btnCancelar").on("click",function(){$("#frmAcreditarEditorial").trigger("reset");limpiarSellos()});$(document).off("click","#btn_accion");$(document).on("click","#btn_accion",function(){$("#tabla_editoriales").css("display","none");$("#frm_editar_editorial").trigger("reset");$("#frmAcreditarEditorial").trigger("reset");limpiarSellos();$("#mdlAcreditarEditorial").css("display","block")});$(document).off("click","#btnCancelar");
$(document).on("click","#btnCancelar",function(){$("#mdlAcreditarEditorial").css("display","none");$("#tabla_editoriales").css("display","block")});function habilitarAgregarSello(){$(".btn_agregar_sello").off("click");$(".btn_agregar_sello").click(function(){let a=$(this).parent().parent();quitarBtnAgregarSello(this);crearInputGroup(a);$(this).remove();habilitarAgregarSello();habilitarEliminarSello()})}
function quitarBtnAgregarSello(a){$("#"+$(a).parent().parent().attr("id")+" div.input-group-append button.btnEliminarSello").attr("btnagregarsello")&&$("#"+$(a).parent().parent().attr("id")+" div.input-group-append button.btnEliminarSello").attr("btnagregarsello","false")}
function crearInputGroup(a){numSellos++;$(a).after($("<div>",{id:"sello_editorial_"+numSellos,"class":"input-group mb-3 sello_editorial"}).append($("<div>",{"class":"input-group-prepend"}).append($("<span>",{"class":"input-group-text"}).text("Sello Editorial:"))).append($("<input>",{id:"txt_sello_editorial_"+numSellos,type:"text","class":"form-control sello_editorial",placeholder:"Nuevo sello editorial"})).append($("<div>",{"class":"input-group-append"}).append($("<button>",{type:"button","class":"btn btn-danger btnEliminarSello",
btnAgregarSello:"true"}).append($("<i>",{"class":"far fa-minus-square"}))).append($("<button>",{type:"button","class":"btn btn-primary btn_agregar_sello"}).append($("<i>",{"class":"far fa-plus-square"})))))}function habilitarEliminarSello(){$(".btnEliminarSello").off("click");$(".btnEliminarSello").click(function(){"true"===$(this).attr("btnagregarsello")&&soltarBtnAgregarSello($(this).parent().parent().attr("id"));$("#"+$(this).parent().parent().attr("id")).remove()})}
function soltarBtnAgregarSello(a){$("#"+$("#"+a).prev().attr("id")+" div.input-group-append").append($(".btn_agregar_sello"));$("#"+$("#"+a).prev().attr("id")+" div.input-group-append button.btnEliminarSello").attr("btnagregarsello","true");habilitarAgregarSello()}
$("#frmAcreditarEditorial").on("submit",function(a){a.preventDefault();a=extraerDatos();$.ajax({async:!0,type:"POST",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:api_acreditar_editorial,data:a,success:function(a){swal("Registro Exitoso!","La editorial se acredito con exito","success")},error:function(a){swal("Error en el registro!","La editorial no se pudo acreditar con exito","error")}})});
function extraerDatos(){return{razonSocial:$("#txt_razon_social").val(),grupoEditorial:$("#txt_grupo_editorial").val(),sellos:extraerSellos(),nombreDirectorGeneral:$("#txt_nombre_director_general").val(),emailDirectorGeneral:$("#txt_email_director_general").val(),celularDirectorGeneral:$("#txt_celular_director_general").val(),nombreRepresentanteEditorial:$("#txt_nombre_representante_editorial").val(),cargoRepresentanteEditorial:$("#txt_cargo_representante_editorial").val(),emailRepresentanteEditorial:$("#txt_email_representante_editorial").val(),
observaciones:$("#txt_observaciones").val()}}function extraerSellos(){let a=0,b="{";$(".sello_editorial").each(function(){""!=$(this).val()&&(b+='"'+a+'":"'+$(this).val()+'",',a++)});b=b.slice(0,b.length-1);return b+="}"}
$("#btn_buscar_editorial").on("click",function(){let a=$("#txt_buscar_editorial").val(),b="";1<=a.length?(b=$.isNumeric(a)?{id:a}:{edi_razonsocial:a},$.ajax({async:!0,type:"POST",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",url:apiBuscarEditorial,data:b,success:function(a){sessionStorage.clear();a.forEach(function(a){sessionStorage.setItem(JSON.stringify(a.id),JSON.stringify(a))});crearTablaCoincidencias(a)},error:function(a){swal("Ateci\u00f3n!","No se encontraron coincidencias",
"warning")}})):(console.log("error"),$("#txt_buscar_editorial").tooltip())});
function crearTablaCoincidencias(a){$("#tbl_editoriales_acreditadas").remove();$("#div_editoriales_acreditadas").append($("<table>",{id:"tbl_editoriales_acreditadas","class":"table table-hover"}));$("#tbl_editoriales_acreditadas").append($("<thead>"));$("#tbl_editoriales_acreditadas thead").append($("<tr>"));$("#tbl_editoriales_acreditadas thead tr").append($("<td>").text("Folio"));$("#tbl_editoriales_acreditadas thead tr").append($("<td>").text("Raz\u00f3n Social"));$("#tbl_editoriales_acreditadas thead tr").append($("<td>").text("Editorial"));
$("#tbl_editoriales_acreditadas thead tr").append($("<td>").text("Acuse"));$("#tbl_editoriales_acreditadas thead tr").append($("<td>").text("Opciones"));$("#tbl_editoriales_acreditadas").append($("<tbody>"));a.forEach(function(a){$("#tbl_editoriales_acreditadas tbody").append($("<tr>",{id:a.id}).append($("<td>").text(a.id)).append($("<td>").text(a.edi_razonsocial)).append($("<td>").text(a.edi_grupoedit)).append($("<td>").append('<i class="fa fa-file"></i>')).append($("<td>").append($("<div>",{"class":"btn-group btn-group-sm"}).append($("<button>",
{"class":"btn btn-primary btn_edit"}).append($("<i>",{"class":"fa fa-edit"}))).append($("<button>",{"class":"btn btn-danger btn_eliminar_editorial"}).append($("<i>",{"class":"fa fa-eraser"}))))))});$("#mdlAcreditarEditorial").css("display","none");habilitarEditarEditorial();habilitarEliminarEditorial()}
function habilitarEditarEditorial(){$(".btn_edit").on("click",function(){let a=$(this).parent().parent().parent().attr("id"),b=JSON.parse(sessionStorage.getItem('"'+a+'"'));$("#mdl_editar_editorial").modal("show");$("#mdl_editar_editorial #edit_txt_razon_social").focus();$("#mdl_editar_editorial #edit_txt_razon_social").attr("id_editorial",b.id);$("#mdl_editar_editorial #edit_txt_razon_social").val(b.edi_razonsocial);$("#mdl_editar_editorial #edit_txt_grupo_editorial").val(b.edi_grupoedit);$("#mdl_editar_editorial #edit_txt_nombre_director_general").val(b.edi_dirgeneral);
$("#mdl_editar_editorial #edit_txt_email_director_general").val(b.edi_dirmail);$("#mdl_editar_editorial #edit_txt_celular_director_general").val(b.edi_dircel);$("#mdl_editar_editorial #edit_txt_nombre_representante_editorial").val(b.edi_repnombre);$("#mdl_editar_editorial #edit_txt_cargo_representante_editorial").val(b.edi_repcargo);$("#mdl_editar_editorial #edit_txt_email_representante_editorial").val(b.edi_repemail);$("#mdl_editar_editorial #edit_txt_observaciones").val(b.edi_observaciones);limpiarSellos();
let c=0;b.sellos.forEach(function(a){c++;$("#mdl_editar_editorial #edit_txt_sello_editorial_"+numSellos).val(a.sel_sello);c<b.sellos.length&&$("#edit_sello_editorial_"+numSellos+" button.btn_agregar_sello_editar").trigger("click")})})}function limpiarSellos(){$(".sello_editorial").each(function(a){a=$(this).attr("id");$("#"+a+" button.btnEliminarSello").trigger("click");numSellos=1})}
function habilitarAgregarSelloEditar(){$(".btn_agregar_sello_editar").off("click");$(".btn_agregar_sello_editar").click(function(){let a=$(this).parent().parent();quitarBtnAgregarSello(this);crearInputGroupEditar(a);$(this).remove();habilitarAgregarSelloEditar();habilitarEliminarSelloEditar()})}
function crearInputGroupEditar(a){numSellos++;$(a).after($("<div>",{id:"edit_sello_editorial_"+numSellos,"class":"input-group mb-3 sello_editorial"}).append($("<div>",{"class":"input-group-prepend"}).append($("<span>",{"class":"input-group-text"}).text("Sello Editorial:"))).append($("<input>",{id:"edit_txt_sello_editorial_"+numSellos,type:"text","class":"form-control edit_sello_editorial",placeholder:"Nuevo sello editorial"})).append($("<div>",{"class":"input-group-append"}).append($("<button>",{type:"button",
"class":"btn btn-danger btnEliminarSello",btnAgregarSello:"true"}).append($("<i>",{"class":"far fa-minus-square"}))).append($("<button>",{type:"button","class":"btn btn-primary btn_agregar_sello_editar"}).append($("<i>",{"class":"far fa-plus-square"})))))}
function habilitarEliminarSelloEditar(){$(".btnEliminarSello").off("click");$(".btnEliminarSello").click(function(){"true"===$(this).attr("btnagregarsello")&&soltarBtnAgregarSelloEditar($(this).parent().parent().attr("id"));$("#"+$(this).parent().parent().attr("id")).remove()})}
function soltarBtnAgregarSelloEditar(a){$("#"+$("#"+a).prev().attr("id")+" div.input-group-append").append($(".btn_agregar_sello_editar"));$("#"+$("#"+a).prev().attr("id")+" div.input-group-append button.btnEliminarSello").attr("btnagregarsello","true");habilitarAgregarSelloEditar()}
function habilitarEliminarEditorial(){$(".btn_eliminar_editorial").off("click");$(".btn_eliminar_editorial").on("click",function(){let a=$(this).parent().parent().parent().attr("id");$(this).parent().parent().parent().remove();$.ajax({url:apiEliminarEditorial,type:"GET",data:"idEditorial="+a,dataType:"json",success:function(){swal("Editorial Eliminada!","La editorial se elimin\u00f3 con exito!","success")},error:function(a){swal("Error!","La editorial no se pudo eliminar con exito!","error");console.log(a)}})})}
$("#frm_editar_editorial").on("submit",function(a){a.preventDefault();a=extraerEditarDatos();$.ajax({url:apiActualizarEditorial,async:!0,type:"POST",dataType:"json",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:a,success:function(a){$("#mdl_editar_editorial").modal("hide");swal("Actualizaci\u00f3n Exitosa!","La editorial se actualiz\u00f3 con exito","success");$("#btn_buscar_editorial").trigger("click")},error:function(a){swal("Error en la actualizaci\u00f3n!","La editorial no se pudo actualizar con exito",
"error");document.write(a.responseText)}})});
function extraerEditarDatos(){return{id:$("#edit_txt_razon_social").attr("id_editorial"),razonSocial:$("#edit_txt_razon_social").val(),grupoEditorial:$("#edit_txt_grupo_editorial").val(),sellos:extraerSellosEdit(),nombreDirectorGeneral:$("#edit_txt_nombre_director_general").val(),emailDirectorGeneral:$("#edit_txt_email_director_general").val(),celularDirectorGeneral:$("#edit_txt_celular_director_general").val(),nombreRepresentanteEditorial:$("#edit_txt_nombre_representante_editorial").val(),cargoRepresentanteEditorial:$("#edit_txt_cargo_representante_editorial").val(),
emailRepresentanteEditorial:$("#edit_txt_email_representante_editorial").val(),observaciones:$("#edit_txt_observaciones").val()}}function extraerSellosEdit(){let a=0,b="{";$(".edit_sello_editorial").each(function(){""!=$(this).val()&&(b+='"'+a+'":"'+$(this).val()+'",',a++)});b=b.slice(0,b.length-1);return b+=',"'+ ++a+'":"'+$("#edit_txt_sello_editorial_1").val()+'"}'}habilitarAgregarSello();habilitarAgregarSelloEditar();habilitarEliminarSello();