var base_url=window.location.protocol+"//"+window.location.host,componente_vista_previa=base_url+"/assets/js/clasificacion_indicativa/vista_previa.min.js",componentes=base_url+"/assets/js/clasificacion_indicativa/componentes.min.js",componente_cabecera,componente_btn_bilioteca,componente_acorden,componente_tab,componente_selecciones,componente_frm_agregar_seleccion,componente_frm_editar_seleccion,api_leer_seleccion_monolingue=base_url+"/administrador/convocatoria/leer_seleccion_monolingue",api_leer_seleccion_bilingue=
base_url+"/administrador/convocatoria/leer_seleccion_bilingue",api_guardar_selecciones=base_url+"/administrador/convocatoria/guardar_seleccion",api_leer_tipo_biblioteca=base_url+"/administrador/convocatoria/leer_tipo_biblioteca",api_vista_previa=base_url+"/administrador/convocatoria/vista_previa",api_leer_textos=base_url+"/administrador/convocatoria/leer_textos",leer_preescolar_primaria_informativos=base_url+"/administrador/convocatoria/leer_categorias/de preescolar a tercero de primaria/textos informativos",
leer_preescolar_primaria_literarios=base_url+"/administrador/convocatoria/leer_categorias/de preescolar a tercero de primaria/textos literarios",leer_primaria_secundaria_informativos=base_url+"/administrador/convocatoria/leer_categorias/de cuarto de primaria a tercero de secundaria/textos informativos",leer_primaria_secundaria_literarios=base_url+"/administrador/convocatoria/leer_categorias/de cuarto de primaria a tercero de secundaria/textos literarios",datos={};
$(document).ready(function(){function g(a,b){$.ajax({url:a,type:"GET",dataType:"JSON",async:!1,contentType:"application/x-www-form-urlencoded; charset=UTF-8",success:function(a){datos[b]=a}})}function f(a,b,c,d,e=null){null===e?$(a).DataTable({ajax:{url:b,method:"GET",cache:"false",dataSrc:"",async:!1},columns:[{data:"categoria",title:"Categor\u00eda",render:function(a){a='<details id="'+componente_selecciones.crear_id(a,c+"_details")+'"><summary>'+componente_selecciones.formato_nombre(a);"</summary></details>";
return a}},{data:"categoria",title:"Agregar",render:function(a){return'<button id="'+componente_selecciones.crear_id(a,"btn_agregar")+'" class="btnAgregar btn btn-success btn-sm" clasificacion="'+c+'" tipo="'+d+'" categoria="'+a+'">Agregar</button>'}}],ordering:!1,paging:!1,responsive:!0}):$(a).DataTable({data:e,columns:[{data:"categoria",title:"Categor\u00eda",render:function(a){return'<details id="'+componente_selecciones.crear_id(a,c+"_details")+"_"+c+'"><summary>'+componente_selecciones.formato_nombre(a)+
"</summary></details>"}},{data:"id",title:"Agregar",render:function(a){return'<button id="'+componente_selecciones.crear_id(a,"btn_agregar")+'" class="btnAgregar btn btn-success btn-sm" clasificacion="'+c+'" tipo="'+d+'" categoria="'+a+'">Agregar</button>'}},{data:"id",title:"id_texto",visible:!1,render:function(a){return'<p id="'+a+'"></p>'}}],ordering:!1,paging:!1,responsive:!0})}function l(){sessionStorage.setItem("bilingue",JSON.stringify(datos.bilingue));sessionStorage.setItem("monolingue",JSON.stringify(datos.monolingue));
datos.monolingue.forEach(function(a){if(a.biblioteca===datos.seleccion_biblioteca){let b=$("#"+componente_selecciones.crear_id(a.categoria,a.clasificacion+"_details")),c=$("#"+componente_selecciones.crear_id(a.categoria,a.clasificacion+"_tbl"));0===$(b).children("div.dataTables_wrapper").length?(c=componente_selecciones.tabla(a.categoria,datos.seleccion_biblioteca),$(c).attr("id",componente_selecciones.crear_id(a.categoria,a.clasificacion+"_tbl")),$(b).append(c),$(b).children("table.dataTable").children("tbody").append(componente_selecciones.cuerpo(a,
datos.seleccion_biblioteca,"monolingue")),h($("#"+componente_selecciones.crear_id(a.categoria,a.clasificacion+"_tbl")))):$(c).append(componente_selecciones.cuerpo(a,datos.seleccion_biblioteca,"monolingue"))}});datos.bilingue.forEach(function(a){if(a.biblioteca===datos.seleccion_biblioteca){let b=$("#"+componente_selecciones.crear_id(a.categoria,a.clasificacion+"_details")),c=$("#"+componente_selecciones.crear_id(a.categoria,a.clasificacion+"_tbl"));0===$(b).children("div.dataTables_wrapper").length?
(c=componente_selecciones.tabla(a.categoria,datos.seleccion_biblioteca),$(c).attr("id",componente_selecciones.crear_id(a.categoria,a.clasificacion+"_tbl")),$(b).append(c),$(b).children("table.dataTable").children("tbody").append(componente_selecciones.cuerpo(a,datos.seleccion_biblioteca,"bilingue")),h($("#"+componente_selecciones.crear_id(a.categoria,a.clasificacion+"_tbl")))):$(c).append(componente_selecciones.cuerpo(a,datos.seleccion_biblioteca,"bilingue"))}})}function h(a){$(a).DataTable({paging:!1,
searching:!1,info:!1,ordering:!1,responsive:!0})}function m(a,b){let c=!1,d=b.categoria+b.biblioteca+b.grado;a.forEach(function(a){a.categoria+a.biblioteca+a.grado==d&&(c=!0)});return c}function n(a,b){let c;datos.textos.forEach(function(d){let e=d.id;d.categoria===a&&d.tipo_clasificacion===b&&(c=e)});return c}sessionStorage.clear();g(api_leer_tipo_biblioteca,"tipo_biblioteca");g(api_leer_seleccion_monolingue,"monolingue");g(api_leer_seleccion_bilingue,"bilingue");g(api_leer_textos,"textos");$("#cabecera_principal").children().remove();
$("#opciones").children().remove();$("#seleccion_clasificacion").children().remove();$("#modales").children().remove();(function(){$.ajax({async:!1,url:componentes,dataType:"SCRIPT",success:function(){componente_cabecera=cabecera;componente_btn_bilioteca=btn_biblioteca;componente_acorden=acordion;componente_tab=tab_categorias;componente_selecciones=tbl_selecciones;componente_frm_agregar_seleccion=frm_agregar_seleccion;componente_frm_editar_seleccion=frm_editar_seleccion}})})();(function(){let a=$("#cabecera_principal");
$(a).append(componente_cabecera.render())})();(function(){let a=$("#seleccion_clasificacion");$(a).append(componente_btn_bilioteca.render(datos.tipo_biblioteca[0].biblioteca))})();$(document).off("click",".btn_seleccion_biblioteca");$(document).on("click",".btn_seleccion_biblioteca",function(){switch($(this).attr("id")){case "btn_biblioteca_aula":datos.seleccion_biblioteca="BA";break;case "btn_biblioteca_escolar":datos.seleccion_biblioteca="BE"}$("#contenedor_btn_biblioteca").remove();var a=$("<div>",
{"class":"btn-group"}),b=$("<button>",{id:"btn_guardar_cambios","class":"btn btn-success",disabled:"disabled"}),c=$("<button>",{id:"btn_vista_previa","class":"btn btn-info"});$(b).text("GUARDAR CAMBIOS");$(c).text("EXCEL");$(a).append(b).append(c);$("#opciones").append(a);$("#modales").append(componente_frm_agregar_seleccion.render(datos.seleccion_biblioteca));$("#modales").append(componente_frm_editar_seleccion.render(datos.seleccion_biblioteca));a=$("#seleccion_clasificacion");switch(datos.seleccion_biblioteca){case "BA":var d=
"Biblioteca de Aula";break;case "BE":d="Biblioteca Escolar"}$(a).append(componente_acorden.render(d));d=$("#menu_preescolar_primaria .card-body");a=$("#menu_primaria_secundaria .card-body");$(d).append(componente_tab.render("preescolar_primaria"));$(a).append(componente_tab.render("primaria_secundaria"));{d=$("<table>",{id:"tbl_preescolar_primaria_informativos","class":"table table-bordered table-striped dataTable"});a=$("<table>",{id:"tbl_preescolar_primaria_literarios","class":"table table-bordered table-striped dataTable"});
b=$("<table>",{id:"tbl_preescolar_primaria_bilingue","class":"table table-bordered table-striped dataTable"});c=$("<table>",{id:"tbl_primaria_secundaria_informativos","class":"table table-bordered table-striped dataTable"});let e=$("<table>",{id:"tbl_primaria_secundaria_literarios","class":"table table-bordered table-striped dataTable"}),k=$("<table>",{id:"tbl_primaria_secundaria_bilingue","class":"table table-bordered table-striped dataTable"});$("#preescolar_primaria_informativos").append(d);$("#preescolar_primaria_literarios").append(a);
$("#preescolar_primaria_bilingue").append(b);$("#primaria_secundaria_informativos").append(c);$("#primaria_secundaria_literarios").append(e);$("#primaria_secundaria_bilingue").append(k);f($("#tbl_preescolar_primaria_informativos"),leer_preescolar_primaria_informativos,"preescolar_primaria","monolingue");f($("#tbl_preescolar_primaria_literarios"),leer_preescolar_primaria_literarios,"preescolar_primaria","monolingue");d=[{id:"bilingue_preescolar_primaria",categoria:"bilingue"}];f($("#tbl_preescolar_primaria_bilingue"),
"bilingue_preescolar_primaria","preescolar_primaria","bilingue",d);f($("#tbl_primaria_secundaria_informativos"),leer_primaria_secundaria_informativos,"primaria_secundaria","monolingue");f($("#tbl_primaria_secundaria_literarios"),leer_primaria_secundaria_literarios,"primaria_secundaria","monolingue");d=[{id:"bilingue_primaria_secundaria",categoria:"bilingue"}];f($("#tbl_primaria_secundaria_bilingue"),"bilingue_primaria_secundaria","primaria_secundaria","bilingue",d)}l()});$(document).off("click","#btn_guardar_cambios");
$(document).on("click","#btn_guardar_cambios",function(){var a=JSON.parse(sessionStorage.getItem("monolingue"));let b=JSON.parse(sessionStorage.getItem("bilingue"));a={monolingue:a,bilingue:b};a=JSON.stringify(a);$.post(api_guardar_selecciones,"selecciones="+a,function(a,b){swal("Hecho!","La selecci\u00f3n fue creada con exito!","success")}).fail(function(a,b){swal("Error!","La selecci\u00f3n no puedo ser creada con exito!","error")})});$(document).off("click","#btn_vista_previa");$(document).on("click",
"#btn_vista_previa",function(){location.href=api_vista_previa});$(document).off("click",".btnAgregar");$(document).on("click",".btnAgregar",function(){let a=$(this).attr("clasificacion"),b=$(this).attr("categoria"),c=$(this).attr("tipo");if("BA"===datos.seleccion_biblioteca){var d="1pre 2pre 3pre 1pri 2pri 3pri".split(" "),e="4pri 5pri 6pri 1sec 2sec 3sec".split(" ");$("#select_grado").empty();"preescolar_primaria"===a?d.forEach(function(a){$("#select_grado").append($("<option>",{value:a}).text(a))}):
"primaria_secundaria"===a&&e.forEach(function(a){$("#select_grado").append($("<option>",{value:a}).text(a))})}else d=["preescolar","primaria"],e=["primaria","secundaria"],$("#select_grado").empty(),"preescolar_primaria"===a?d.forEach(function(a){$("#select_grado").append($("<option>",{value:a}).text(a))}):"primaria_secundaria"===a&&e.forEach(function(a){$("#select_grado").append($("<option>",{value:a}).text(a))});$("#header_agregar h5").text("Crear Selecci\u00f3n - "+b.charAt(0).toUpperCase()+b.slice(1));
$("#txt_seleccion").attr("max",$("#txt_preseleccion").val());$("#btn_guardar_seleccion").attr("tabla_seleccion",componente_selecciones.crear_id(b,a+"_tbl"));$("#btn_guardar_seleccion").attr("tipo",c);$("#btn_guardar_seleccion").attr("categoria",b);$("#btn_guardar_seleccion").attr("clasificacion",a);$("#frm_agregar_seleccion").trigger("reset");$("#mdl_agregar").modal("show")});$(document).off("submit","#frm_agregar_seleccion");$(document).on("submit","#frm_agregar_seleccion",function(){event.preventDefault();
event.stopPropagation();let a=$("#btn_guardar_seleccion").attr("tipo");var b=$("#btn_guardar_seleccion").attr("clasificacion"),c=$("#"+componente_selecciones.crear_id($("#btn_guardar_seleccion").attr("categoria"),b+"_details"));let d=JSON.parse(sessionStorage.getItem(a)),e={id:Math.floor(1001*Math.random()),clasificacion:$("#btn_guardar_seleccion").attr("clasificacion"),categoria:$("#btn_guardar_seleccion").attr("categoria"),biblioteca:datos.seleccion_biblioteca,grado:$("#select_grado").val(),numPreseleccion:$("#txt_preseleccion").val(),
numSeleccion:$("#txt_seleccion").val()};"monolingue"===a&&(e.id_texto=n($("#btn_guardar_seleccion").attr("categoria"),b));!1===this.checkValidity()?this.classList.add("was-validated"):0===$(c).children("div.dataTables_wrapper").length?(b=componente_selecciones.tabla(e.categoria,datos.seleccion_biblioteca),$(b).attr("id",componente_selecciones.crear_id(e.categoria,e.clasificacion+"_tbl")),$(c).append(b),$(c).children("table.dataTable").children("tbody").append(componente_selecciones.cuerpo(e,datos.seleccion_biblioteca,
a)),h(b),d.push(e),sessionStorage.setItem(a,JSON.stringify(d)),swal("Exito!","La selecci\u00f3n se guardo correctamente","success"),$("#mdl_vista_previa").remove(),$("#btn_guardar_cambios").removeAttr("disabled")):(c=$("#"+$("#btn_guardar_seleccion").attr("tabla_seleccion")),m(d,e)?swal("Atenci\u00f3n!","La selecci\u00f3n ya existe","warning"):8>$(c).children("tbody").children().length?($(c).children("tbody").append(componente_selecciones.cuerpo(e,datos.seleccion_biblioteca,a)),d.push(e),sessionStorage.setItem(a,
JSON.stringify(d)),swal("Exito!","La selecci\u00f3n se guardo correctamente","success"),$("#mdl_vista_previa").remove(),$("#btn_guardar_cambios").removeAttr("disabled")):swal("Atenci\u00f3n!","No puedes superar las 8 selecciones por categor\u00eda","warning"));$(this).trigger("reset")});$(document).off("change","#txt_preseleccion");$(document).on("change","#txt_preseleccion",function(){let a=$(this).val();$("#txt_seleccion").attr("max",a)});$(document).off("click",".btn_editar");$(document).on("click",
".btn_editar",function(){let a=$(this).attr("clasificacion");var b=$(this).attr("tipo");let c=$(this).attr("id_seleccion"),d=$(this).attr("categoria");b=JSON.parse(sessionStorage.getItem(b));$("#frm_editar_seleccion").trigger("reset");b.forEach(function(b){if(parseInt(b.id)===parseInt(c)){if("BA"===datos.seleccion_biblioteca){var d="1pre 2pre 3pre 1pri 2pri 3pri".split(" "),e="4pri 5pri 6pri 1sec 2sec 3sec".split(" ");"preescolar_primaria"===a?($("#edit_select_grado").empty(),d.forEach(function(a){$("#edit_select_grado").append($("<option>",
{value:a}).text(a))})):"primaria_secundaria"===a&&($("#edit_select_grado").empty(),e.forEach(function(a){$("#edit_select_grado").append($("<option>",{value:a}).text(a))}))}else d=["preescolar","primaria"],e=["primaria","secundaria"],"preescolar_primaria"===a?($("#edit_select_grado").empty(),d.forEach(function(a){$("#edit_select_grado").append($("<option>",{value:a}).text(a))})):"primaria_secundaria"===a&&($("#edit_select_grado").empty(),e.forEach(function(a){$("#edit_select_grado").append($("<option>",
{value:a}).text(a))}));$("#edit_select_grado").val(b.grado);$("#edit_txt_preseleccion").val(b.numPreseleccion);$("#edit_txt_seleccion").val(b.numSeleccion)}});$("#header_editar h5").text("Editar Selecci\u00f3n - "+d.charAt(0).toUpperCase()+d.slice(1));$("#edit_txt_seleccion").attr("max",$("#edit_txt_preseleccion").val());$("#btn_actualizar_seleccion").attr("clasificacion",a);$("#btn_actualizar_seleccion").attr("tabla_seleccion",$(this).attr("tabla_seleccion"));$("#btn_actualizar_seleccion").attr("tipo",
$(this).attr("tipo"));$("#btn_actualizar_seleccion").attr("categoria",$(this).attr("categoria"));$("#btn_actualizar_seleccion").attr("id_seleccion",$(this).attr("id_seleccion"));$("#mdl_editar").modal("show")});$(document).off("submit","#frm_editar_seleccion");$(document).on("submit","#frm_editar_seleccion",function(){event.preventDefault();event.stopPropagation();$("#"+$("#btn_actualizar_seleccion").attr("tabla_seleccion"));let a=$("#btn_actualizar_seleccion").attr("tipo"),b=JSON.parse(sessionStorage.getItem(a));
var c=$("#btn_actualizar_seleccion").attr("id_seleccion"),d=$("#btn_actualizar_seleccion").attr("categoria"),e=datos.seleccion_biblioteca,f=$("#edit_select_grado").val(),g=$("#edit_txt_preseleccion").val(),h=$("#edit_txt_seleccion").val();!1===this.checkValidity()?this.classList.add("was-validated"):(b.forEach(function(a){parseInt(a.id)===parseInt(c)&&(a.categoria=d,a.biblioteca=e,a.grado=f,a.numPreseleccion=g,a.numSeleccion=h)}),sessionStorage.setItem(a,JSON.stringify(b)),"BA"===datos.seleccion_biblioteca?
($($("tr[id_seleccion="+$("#btn_actualizar_seleccion").attr("id_seleccion")+"]").children()[0]).text(f),$($("tr[id_seleccion="+$("#btn_actualizar_seleccion").attr("id_seleccion")+"]").children()[1]).text(g),$($("tr[id_seleccion="+$("#btn_actualizar_seleccion").attr("id_seleccion")+"]").children()[2]).text(h)):($($("tr[id_seleccion="+$("#btn_actualizar_seleccion").attr("id_seleccion")+"]").children()[0]).text(g),$($("tr[id_seleccion="+$("#btn_actualizar_seleccion").attr("id_seleccion")+"]").children()[1]).text(h)),
$("#btn_guardar_cambios").removeAttr("disabled"),swal("Exito!","La selecci\u00f3n se actualiz\u00f3 correctamente","success"))});$(document).off("change","#edit_txt_preseleccion");$(document).on("change","#edit_txt_preseleccion",function(){let a=$(this).val();$("#edit_txt_seleccion").attr("max",a)});$(document).off("click",".btn_eliminar");$(document).on("click",".btn_eliminar",function(){let a=$(this).attr("id_seleccion"),b=$(this).attr("tipo"),c=$("tr[id_seleccion="+a+"]"),d=JSON.parse(sessionStorage.getItem(b));
console.log(d);console.log(a);d.forEach(function(b,c){parseInt(a)===parseInt(b.id)&&d.splice(c,1)});sessionStorage.setItem(b,JSON.stringify(d));$(c).remove();$("#btn_guardar_cambios").removeAttr("disabled")})});