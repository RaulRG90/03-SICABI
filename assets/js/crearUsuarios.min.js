$(document).ready(function(){function t(){$(".eliminar").off("click");$(".eliminar").on("click",function(){let a=$(this).parent().attr("usuId");a=JSON.stringify(a);$.ajax({url:apiEliminarUsuario,type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:"usuId="+a,dataType:"json",success:function(){swal("Usuario Eliminado!","El usuario se elimino de forma correcta!","success");c.crearLista()},error:function(a){swal("Error!","El usuario no se pudo eliminar!","error");console.log(a)}})})}
function u(){$(".editar").off("click");$(".editar").on("click",function(){let a=$(this).parent().attr("usuid");$.ajax({url:apiLeerUsuario,type:"GET",data:"usuId="+a,dataType:"json",success:function(a){$("#frm_editar_acreditador").modal("show");$("#usu_id").val(a[0].usu_id);edit_perfil;$("#frm_editar_acreditador #edit_nombre input").val(a[0].usu_nombre);$("#frm_editar_acreditador #edit_usuario input").val(a[0].usu_login);$("#edit_perfil").val(a[0].id_perfil);$("#edit_modulo").val(a[0].id_modulo);$("#frm_editar_acreditador #edit_contrasenia input").val(a[0].usu_pass);
$("#frm_editar_acreditador #edit_confirm_contrasenia input").val(a[0].usu_pass)}})})}$(".ver_contrasenia").css("cursor","pointer");$(".ver_contrasenia").on("click",function(){let a=$(this).parent().attr("id");"text"==$("#"+a+" input").attr("type")?$("#"+a+" input").attr("type","password"):$("#"+a+" input").attr("type","text")});$("#frm_crear_usuario").on("submit",function(a){a.preventDefault();a={nombre:$("#nombre input").val(),usuario:$("#usuario input").val(),perfil:$("#select_perfil").val(),modulo:$("#select_modulo").val(),
contrasenia:$("#contrasenia input").val()};a=JSON.stringify(a);$.ajax({url:apiGuardarUsuario,type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:"usuario="+a,dataType:"json",success:function(){swal("Usuario Creado!","El usuario se creo de forma correcta!","success");c.crearLista()},error:function(a){swal("Error!","El usuario no se pudo crear!","error")}})});$("#contrasenia input").on("change",function(){let a=$(this).val();$("#confirm_contrasenia input").attr("pattern",
a)});$("#frm_editar_acreditador").on("submit",function(a){a.preventDefault();a=$("#frm_editar_acreditador #usu_id").val();let b=$("#frm_editar_acreditador #edit_nombre input").val(),d=$("#frm_editar_acreditador #edit_usuario input").val(),e=$("#edit_perfil").val(),f=$("#edit_modulo").val(),g=$("#frm_editar_acreditador #edit_contrasenia input").val();a={usu_id:a,usu_nombre:b,usu_login:d,id_perfil:e,id_modulo:f,usu_pass:g};a=JSON.stringify(a);$.ajax({url:apiActualizarUsuario,type:"POST",contentType:"application/x-www-form-urlencoded; charset=UTF-8",
data:"acreditador="+a,dataType:"JSON",success:function(){swal("Usuario Actualizado!","El usuario se actualiz\u00f3 de forma correcta!","success");c.crearLista()},error:function(a){swal("Error!","El usuario no se actualiz\u00f3 de forma correcta!","error")}})});var b={posicion:"",etiqueta:"",atributos:"",hijos:"",valor:"",texto:"",html:"",establecerAtributos:function(a){this.posicion="undefined"===typeof a.posicion?"append":a.posicion;this.etiqueta=a.etiqueta;this.atributos="undefined"===typeof a.atributos?
"":a.atributos;this.hijos="undefined"===typeof a.hijos?"":a.hijos;this.valor="undefined"===typeof a.valor?"":a.valor;this.texto="undefined"===typeof a.texto?"":a.texto;this.html="undefined"===typeof a.html?"":a.html},crearEsquema:function(a){let b;if(""!=this.etiqueta)switch(b=$(this.etiqueta,this.atributos),this.posicion){case "append":$(a).append(b);break;case "prepend":$(a).prepend(b);break;case "after":$(a).after(b);break;case "before":$(a).before(b)}else b=a;""!==this.hijos&&this.hijos.forEach(function(a){a.crearEsquema(b)});
""!==this.texto&&$(b).text(this.texto);""!==this.valor&&$(b).val(this.valor);""!==this.html&&$(b).html(this.html)}},c={crearLista:function(){$("#tbl_usuarios").remove();$.ajax({async:!0,type:"GET",dataType:"json",url:apiLeerUsuarios,success:function(a){sessionStorage.setItem("usuarios",JSON.stringify(a));let c=$("#lista_usuarios"),d=Object.create(b),e=Object.create(b),f=Object.create(b),g=Object.create(b),h=Object.create(b),k=Object.create(b),l=Object.create(b),m=Object.create(b),n=Object.create(b),
p=Object.create(b),q={};g.establecerAtributos({etiqueta:"<th>",posicion:"append",texto:"Nombre"});h.establecerAtributos({etiqueta:"<th>",posicion:"append",texto:"Usuario"});k.establecerAtributos({etiqueta:"<th>",posicion:"append",texto:"Contrase\u00f1a"});l.establecerAtributos({etiqueta:"<th>",posicion:"append",texto:"Perfil"});m.establecerAtributos({etiqueta:"<th>",posicion:"append",texto:"M\u00f3dulo"});n.establecerAtributos({etiqueta:"<th>",posicion:"append",texto:"Opciones"});f.establecerAtributos({etiqueta:"<tr>",
posicion:"append",hijos:[g,h,l,m,k,n]});e.establecerAtributos({etiqueta:"<thead>",posicion:"append",hijos:[f]});let r=[];a.forEach(function(a){let c=Object.create(b),d=Object.create(b),e=Object.create(b),f=Object.create(b),g=Object.create(b),h=Object.create(b),k=Object.create(b);c.establecerAtributos({etiqueta:"<td>",posicion:"append",texto:a.usu_nombre});d.establecerAtributos({etiqueta:"<td>",posicion:"append",texto:a.usu_login});f.establecerAtributos({etiqueta:"<td>",posicion:"append",texto:a.id_perfil});
g.establecerAtributos({etiqueta:"<td>",posicion:"append",texto:a.id_modulo});e.establecerAtributos({etiqueta:"<td>",posicion:"append",texto:"*****"});h.establecerAtributos({etiqueta:"<td>",posicion:"append",html:'<div class="btn-group" usuId="'+a.usu_id+'" ><button type="button" class="btn btn-primary editar"><i class="fa fa-edit"></i></button><button type="button" class="btn btn-danger eliminar"><i class="fa fa-eraser"></i></button></div>'});k.establecerAtributos({etiqueta:"<tr>",posicion:"append",
hijos:[c,d,f,g,e,h]});r.push(k)});p.establecerAtributos({etiqueta:"<tbody>",posicion:"append",hijos:r});q={id:"tbl_usuarios","class":"table table-hover"};d.establecerAtributos({etiqueta:"<table>",atributos:q,posicion:"append",hijos:[e,p]});d.crearEsquema(c);t();u()},error:function(a){console.log(a)}})}};c.crearLista()});